


<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title> | </title>

        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/highlight.css">
        <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>

        <!-- Font Awesome -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='/jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body>
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter">

              
              <li>
                <a href="/about-this-book.html"> About This Book</a>
              </li>
                
              
              <li>
                <a href="/language.html"> Language Structure</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/language/keywords.html"> Keywords</a>
                          </li>
                        
                          <li>
                            <a href="/language/literals.html"> Literals</a>
                          </li>
                        
                          <li>
                            <a href="/language/variables-constants.html"> Variables and Constants</a>
                          </li>
                        
                          <li>
                            <a href="/language/assignment.html"> Assignment</a>
                          </li>
                        
                          <li>
                            <a href="/language/control-expressions.html"> Control Expressions</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-def.html"> Defining methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-call.html"> Calling methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/modules-classes.html"> Modules and Classes</a>
                          </li>
                        
                          <li>
                            <a href="/language/exceptions.html"> Exceptions</a>
                          </li>
                        
                          <li>
                            <a href="/language/refinements.html"> Refinements</a>
                          </li>
                        
                          <li>
                            <a href="/language/precedence.html"> Precedence</a>
                          </li>
                        
                          <li>
                            <a href="/language/files.html"> File Structure</a>
                          </li>
                        
                          <li>
                            <a href="/language/globals.html"> Globals</a>
                          </li>
                        
                          <li>
                            <a href="/language/metaprogramming.html"> Metaprogramming</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/builtin.html"> Built-in Classes</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/builtin/core.html"> Language Core</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/types.html"> Value Types</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/errors-warnings.html"> Errors and Warnings</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/system-cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/concurrency-parallelism.html"> Concurrency and Parallelism</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/internals.html"> Interpreter Internals</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/marshal.html"> Marshal</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/random.html"> Random</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/stdlib.html"> Standard Library</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/stdlib/patterns.html"> Design Patterns</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/formats.html"> Formats</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/development-debugging.html"> Development and Debugging</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/string-utilities.html"> String Utilities</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/networking-web.html"> Networking and Web</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cryptography-encoding.html"> Cryptography and Encoding</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/misc.html"> Miscellaneous Libraries</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/advanced-topics.html"> Advanced Topics</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/advanced-topics/third-party-libraries.html"> Third-Party Libraries</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/tools-approaches.html"> Tools and Approaches</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/contributing.html"> Contributing To Ruby</a>
                          </li>
                        
                    </ul>
                
              

            </ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                 
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'optparse'</span>
</code></pre></div></div>

<h1 id="optionparser">OptionParser</h1>

<p>OptionParser is a class for command-line option analysis. It is much
more advanced, yet also easier to use, than GetoptLong, and is a more
Ruby-oriented solution.</p>

<h2 id="features">Features</h2>

<ol>
  <li>The argument specification and the code to handle it are written in
the same place.</li>
  <li>It can output an option summary; you don’t need to maintain this
string separately.</li>
  <li>Optional and mandatory arguments are specified very gracefully.</li>
  <li>Arguments can be automatically converted to a specified class.</li>
  <li>Arguments can be restricted to a certain set.</li>
</ol>

<p>All of these features are demonstrated in the examples below. See
<code class="highlighter-rouge">#make_switch</code> for full documentation.</p>

<h2 id="minimal-example">Minimal example</h2>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'optparse'</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<span class="no">OptionParser</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
  <span class="n">opts</span><span class="p">.</span><span class="nf">banner</span> <span class="o">=</span> <span class="s2">"Usage: example.rb [options]"</span>

  <span class="n">opts</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="s2">"-v"</span><span class="p">,</span> <span class="s2">"--[no-]verbose"</span><span class="p">,</span> <span class="s2">"Run verbosely"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:verbose</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">.</span><span class="nf">parse!</span>

<span class="nb">p</span> <span class="n">options</span>
<span class="nb">p</span> <span class="no">ARGV</span>
</code></pre></div></div>

<h2 id="generating-help">Generating Help</h2>

<p>OptionParser can be used to automatically generate help for the commands
you write:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'optparse'</span>

<span class="no">Options</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Parser</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="no">Options</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"world"</span><span class="p">)</span>

    <span class="n">opt_parser</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
      <span class="n">opts</span><span class="p">.</span><span class="nf">banner</span> <span class="o">=</span> <span class="s2">"Usage: example.rb [options]"</span>

      <span class="n">opts</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="s2">"-nNAME"</span><span class="p">,</span> <span class="s2">"--name=NAME"</span><span class="p">,</span> <span class="s2">"Name to say hello to"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
        <span class="n">args</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="n">n</span>
      <span class="k">end</span>

      <span class="n">opts</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="s2">"-h"</span><span class="p">,</span> <span class="s2">"--help"</span><span class="p">,</span> <span class="s2">"Prints this help"</span><span class="p">)</span> <span class="k">do</span>
        <span class="nb">puts</span> <span class="n">opts</span>
        <span class="nb">exit</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">opt_parser</span><span class="p">.</span><span class="nf">parse!</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">options</span> <span class="o">=</span> <span class="no">Parser</span><span class="p">.</span><span class="nf">parse</span> <span class="sx">%w[--help]</span>

<span class="c1">#=&gt;</span>
   <span class="c1"># Usage: example.rb [options]</span>
   <span class="c1">#     -n, --name=NAME                  Name to say hello to</span>
   <span class="c1">#     -h, --help                       Prints this help</span>
</code></pre></div></div>

<h2 id="required-arguments">Required Arguments</h2>

<p>For options that require an argument, option specification strings may
include an option name in all caps. If an option is used without the
required argument, an exception will be raised. require ‘optparse’</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<span class="no">OptionParser</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">parser</span><span class="o">|</span>
  <span class="n">parser</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="s2">"-r"</span><span class="p">,</span> <span class="s2">"--require LIBRARY"</span><span class="p">,</span>
            <span class="s2">"Require the LIBRARY before executing your script"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">lib</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"You required </span><span class="si">#{</span><span class="n">lib</span><span class="si">}</span><span class="s2">!"</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">.</span><span class="nf">parse!</span>
</code></pre></div></div>

<p>Used:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-3.2$ ruby optparse-test.rb -r
optparse-test.rb:9:in `&lt;main&gt;': missing argument: -r (OptionParser::MissingArgument)
bash-3.2$ ruby optparse-test.rb -r my-library
You required my-library!
</code></pre></div></div>

<h2 id="type-coercion">Type Coercion</h2>

<p>OptionParser supports the ability to coerce command line arguments into
objects for us.</p>

<p>OptionParser comes with a few ready-to-use kinds of type coercion. They
are:</p>

<ul>
  <li>Date – Anything accepted by <code class="highlighter-rouge">Date.parse</code></li>
  <li>DateTime – Anything accepted by <code class="highlighter-rouge">DateTime.parse</code></li>
  <li>Time – Anything accepted by <code class="highlighter-rouge">Time.httpdate</code> or <code class="highlighter-rouge">Time.parse</code></li>
  <li>URI – Anything accepted by <code class="highlighter-rouge">URI.parse</code></li>
  <li>Shellwords – Anything accepted by <code class="highlighter-rouge">Shellwords.shellwords</code></li>
  <li>String – Any non-empty string</li>
  <li>Integer – Any integer. Will convert octal. (e.g. 124, -3, 040)</li>
  <li>Float – Any float. (e.g. 10, 3.14, -100E+13)</li>
  <li>Numeric – Any integer, float, or rational (1, 3.4, 1/3)</li>
  <li>DecimalInteger – Like <code class="highlighter-rouge">Integer</code>, but no octal format.</li>
  <li>OctalInteger – Like <code class="highlighter-rouge">Integer</code>, but no decimal format.</li>
  <li>DecimalNumeric – Decimal integer or float.</li>
  <li>TrueClass – Accepts ‘+, yes, true, -, no, false’ and defaults as
<code class="highlighter-rouge">true</code></li>
  <li>FalseClass – Same as <code class="highlighter-rouge">TrueClass</code>, but defaults to <code class="highlighter-rouge">false</code></li>
  <li>Array – Strings separated by ‘,’ (e.g. 1,2,3)</li>
  <li>Regexp – Regular expressions. Also includes options.</li>
</ul>

<p>We can also add our own coercions, which we will cover soon.</p>

<h3 id="using-built-in-conversions">Using Built-in Conversions</h3>

<p>As an example, the built-in <code class="highlighter-rouge">Time</code> conversion is used. The other
built-in conversions behave in the same way. OptionParser will attempt
to parse the argument as a <code class="highlighter-rouge">Time</code>. If it succeeds, that time will be
passed to the handler block. Otherwise, an exception will be raised.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'optparse'</span>
<span class="nb">require</span> <span class="s1">'optparse/time'</span>
<span class="no">OptionParser</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">parser</span><span class="o">|</span>
  <span class="n">parser</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="s2">"-t"</span><span class="p">,</span> <span class="s2">"--time [TIME]"</span><span class="p">,</span> <span class="no">Time</span><span class="p">,</span> <span class="s2">"Begin execution at given time"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">time</span><span class="o">|</span>
    <span class="nb">p</span> <span class="n">time</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">.</span><span class="nf">parse!</span>
</code></pre></div></div>

<p>Used:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-3.2$ ruby optparse-test.rb  -t nonsense
... invalid argument: -t nonsense (OptionParser::InvalidArgument)
from ... time.rb:5:in `block in &lt;top (required)&gt;`
from optparse-test.rb:31:in `&lt;main&gt;'
bash-3.2$ ruby optparse-test.rb  -t 10-11-12
2010-11-12 00:00:00 -0500
bash-3.2$ ruby optparse-test.rb  -t 9:30
2014-08-13 09:30:00 -0400
</code></pre></div></div>

<h3 id="creating-custom-conversions">Creating Custom Conversions</h3>

<p>The <code class="highlighter-rouge">accept</code> method on OptionParser may be used to create converters. It
specifies which conversion block to call whenever a class is specified.
The example below uses it to fetch a <code class="highlighter-rouge">User</code> object before the <code class="highlighter-rouge">on</code>
handler receives it.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'optparse'</span>

<span class="no">User</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find_user</span> <span class="nb">id</span>
  <span class="n">not_found</span> <span class="o">=</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="k">raise</span> <span class="s2">"No User Found for id </span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
  <span class="p">[</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"Sam"</span><span class="p">),</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"Gandalf"</span><span class="p">)</span> <span class="p">].</span><span class="nf">find</span><span class="p">(</span><span class="n">not_found</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">u</span><span class="o">|</span>
    <span class="n">u</span><span class="p">.</span><span class="nf">id</span> <span class="o">==</span> <span class="nb">id</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">op</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="p">.</span><span class="nf">new</span>
<span class="n">op</span><span class="p">.</span><span class="nf">accept</span><span class="p">(</span><span class="no">User</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user_id</span><span class="o">|</span>
  <span class="n">find_user</span> <span class="n">user_id</span><span class="p">.</span><span class="nf">to_i</span>
<span class="k">end</span>

<span class="n">op</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="s2">"--user ID"</span><span class="p">,</span> <span class="no">User</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">user</span>
<span class="k">end</span>

<span class="n">op</span><span class="p">.</span><span class="nf">parse!</span>
</code></pre></div></div>

<p>output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash-3.2$ ruby optparse-test.rb --user 1
#&lt;struct User id=1, name="Sam"&gt;
bash-3.2$ ruby optparse-test.rb --user 2
#&lt;struct User id=2, name="Gandalf"&gt;
bash-3.2$ ruby optparse-test.rb --user 3
optparse-test.rb:15:in `block in find_user`: No User Found for id 3 (RuntimeError)
</code></pre></div></div>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/optparse/rdoc/OptionParser.html">OptionParser
Reference</a></p>



                <!-- Mobile navigation buttons -->


                <!--
                    <a href="cli/cli-tool.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                 -->

            </div>



               <!--
                <a href="cli/cli-tool.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
                 -->

        </div>


        <script src="/js/book.js"></script>
    </body>
</html>
